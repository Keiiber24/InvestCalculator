<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Summary - Investment Calculator</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
</head>
<body>
    <div class="container py-4">
        {% include 'partials/navbar.html' %}

        <!-- Refresh Button -->
        <div class="d-flex justify-content-end mb-4">
            <button id="refreshSummary" class="btn btn-warning">
                <i class="bi bi-arrow-clockwise me-2"></i>
                Refresh Summary
            </button>
        </div>

        <div class="row g-4">
            <!-- Overview Cards -->
            <div class="col-12">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-primary d-flex justify-content-between align-items-center">
                        <h2 class="card-title h4 mb-0 text-yellow">Portfolio Overview</h2>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Total Trades -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-graph-up-arrow fs-3 text-warning me-3"></i>
                                    <div>
                                        <h6 class="text-muted mb-1">Total Trades</h6>
                                        <h3 class="mb-0" data-number="{{ summary.total_trades }}">{{ summary.total_trades }}</h3>
                                    </div>
                                </div>
                            </div>
                            <!-- Open/Closed Trades -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-clock-history fs-3 text-warning me-3"></i>
                                    <div>
                                        <h6 class="text-muted mb-1">Open/Closed</h6>
                                        <h3 class="mb-0">{{ summary.open_trades }}/{{ summary.closed_trades }}</h3>
                                    </div>
                                </div>
                            </div>
                            <!-- Win Rate -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-trophy fs-3 text-warning me-3"></i>
                                    <div>
                                        <h6 class="text-muted mb-1">Win Rate</h6>
                                        <h3 class="mb-0" data-percentage="{{ summary.win_rate }}">{{ summary.win_rate }}%</h3>
                                    </div>
                                </div>
                            </div>
                            <!-- Total P/L -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-cash-stack fs-3 text-warning me-3"></i>
                                    <div>
                                        <h6 class="text-muted mb-1">Total P/L</h6>
                                        <h3 class="mb-0" data-currency="{{ summary.total_profit_loss }}">
                                            {{ summary.total_profit_loss }}
                                        </h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Position Analysis -->
            <div class="col-md-6">
                <div class="card shadow-lg border-0 h-100">
                    <div class="card-header bg-primary">
                        <h2 class="card-title h4 mb-0 text-yellow">Position Analysis</h2>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <!-- Total Invested -->
                            <div class="col-12">
                                <h6 class="text-muted">Total Invested</h6>
                                <h4 data-currency="{{ summary.total_invested }}">{{ summary.total_invested }}</h4>
                            </div>
                            <!-- Current Positions Value -->
                            <div class="col-12">
                                <h6 class="text-muted">Current Positions Value</h6>
                                <h4 data-currency="{{ summary.current_positions_value }}">{{ summary.current_positions_value }}</h4>
                            </div>
                            <!-- Average Position Size -->
                            <div class="col-12">
                                <h6 class="text-muted">Average Position Size</h6>
                                <h4 data-currency="{{ summary.avg_position_size }}">{{ summary.avg_position_size }}</h4>
                            </div>
                            <!-- Largest Position -->
                            <div class="col-12">
                                <h6 class="text-muted">Largest Position</h6>
                                <h4 data-currency="{{ summary.largest_position }}">{{ summary.largest_position }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Trades -->
            <div class="col-md-6">
                <div class="card shadow-lg border-0 h-100">
                    <div class="card-header bg-primary">
                        <h2 class="card-title h4 mb-0 text-yellow">Recent Trades</h2>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Ticker</th>
                                        <th>Units</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if summary.recent_trades %}
                                        {% for trade in summary.recent_trades %}
                                        <tr>
                                            <td>{{ trade.Date[:10] if trade.Date else '-' }}</td>
                                            <td>{{ trade.Market }}</td>
                                            <td data-number="{{ trade.Units }}" data-decimals="8">{{ trade.Units }}</td>
                                            <td>
                                                <span class="badge {{ 'bg-success' if trade.get('Remaining Units', 0) > 0 else 'bg-secondary' }}">
                                                    {{ 'Open' if trade.get('Remaining Units', 0) > 0 else 'Closed' }}
                                                </span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="4" class="text-center">No trades available</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trades by Market -->
            <div class="col-12">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-primary">
                        <h2 class="card-title h4 mb-0 text-yellow">Trades by Market</h2>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table mb-0">
                                <thead>
                                    <tr>
                                        <th>Market</th>
                                        <th>Number of Trades</th>
                                        <th>Total Position Value</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if summary.trades_by_market %}
                                        {% for market in summary.trades_by_market %}
                                        <tr>
                                            <td>{{ market.Market }}</td>
                                            <td data-number="{{ market.Count }}">{{ market.Count }}</td>
                                            <td data-currency="{{ market['Total Position'] }}">{{ market['Total Position'] }}</td>
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="3" class="text-center">No market data available</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Highlights -->
            {% if summary.best_performing or summary.worst_performing %}
            <div class="col-12">
                <div class="card shadow-lg border-0">
                    <div class="card-header bg-primary">
                        <h2 class="card-title h4 mb-0 text-yellow">Performance Highlights</h2>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            {% if summary.best_performing %}
                            <div class="col-md-6">
                                <div class="card bg-success bg-opacity-10 border-0">
                                    <div class="card-body">
                                        <h5 class="card-title text-success">Best Performing Trade</h5>
                                        <p class="mb-1">Market: {{ summary.best_performing.Market }}</p>
                                        <p class="mb-1">Entry Price: <span data-currency="{{ summary.best_performing['Entry Price'] }}">{{ summary.best_performing['Entry Price'] }}</span></p>
                                        <p class="mb-0">Units: <span data-number="{{ summary.best_performing.Units }}" data-decimals="8">{{ summary.best_performing.Units }}</span></p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% if summary.worst_performing %}
                            <div class="col-md-6">
                                <div class="card bg-danger bg-opacity-10 border-0">
                                    <div class="card-body">
                                        <h5 class="card-title text-danger">Worst Performing Trade</h5>
                                        <p class="mb-1">Market: {{ summary.worst_performing.Market }}</p>
                                        <p class="mb-1">Entry Price: <span data-currency="{{ summary.worst_performing['Entry Price'] }}">{{ summary.worst_performing['Entry Price'] }}</span></p>
                                        <p class="mb-0">Units: <span data-number="{{ summary.worst_performing.Units }}" data-decimals="8">{{ summary.worst_performing.Units }}</span></p>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    
    <script type="module" src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/summary.js') }}"></script>
</body>
</html>
